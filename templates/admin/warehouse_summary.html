{% extends "base.html" %}

{% block title %}Warehouse Summary - FIMS{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-bar-chart-fill"></i> Warehouse Stock Summary</h2>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover" id="summaryTable">
                <thead class="table-dark">
                    <tr>
                        <th>
                            Company
                            <button class="btn btn-sm btn-outline-light filter-btn" onclick="filterColumn(0)">
                                <i class="bi bi-filter"></i>
                            </button>
                        </th>
                        <th>
                            Product
                            <button class="btn btn-sm btn-outline-light filter-btn" onclick="filterColumn(1)">
                                <i class="bi bi-filter"></i>
                            </button>
                        </th>
                        <th>
                            Quantity (MT)
                            <button class="btn btn-sm btn-outline-light filter-btn" onclick="filterColumn(2)">
                                <i class="bi bi-filter"></i>
                            </button>
                        </th>
                        <th>
                            Warehouse
                            <button class="btn btn-sm btn-outline-light filter-btn" onclick="filterColumn(3)">
                                <i class="bi bi-filter"></i>
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% if summary %}
                        {% for row in summary %}
                        <tr>
                            <td><strong>{{ row[0] or 'N/A' }}</strong></td>
                            <td>{{ row[1] or 'N/A' }}</td>
                            <td class="text-end"><span class="badge bg-success">{{ "%.2f"|format(row[2]) }} MT</span></td>
                            <td>{{ row[3] or 'N/A' }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">No warehouse stock data available</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function filterColumn(columnIndex) {
    const table = document.getElementById('summaryTable');
    const rows = Array.from(table.querySelectorAll('tbody tr'));
    
    // Get unique values for this column
    const uniqueValues = new Set();
    rows.forEach(row => {
        const cell = row.cells[columnIndex];
        if (cell) {
            uniqueValues.add(cell.textContent.trim());
        }
    });
    
    // Create filter options
    const filterValue = prompt(`Filter by ${table.rows[0].cells[columnIndex].textContent.split('\n')[0].trim()}:\n\nAvailable values:\n${Array.from(uniqueValues).join('\n')}\n\nEnter value to filter (leave empty to show all):`);
    
    if (filterValue === null) return; // User cancelled
    
    // Apply filter
    rows.forEach(row => {
        const cell = row.cells[columnIndex];
        if (filterValue === '' || cell.textContent.trim().includes(filterValue)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
